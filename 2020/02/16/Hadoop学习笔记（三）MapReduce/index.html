<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Hadoop学习笔记（三）MapReduce | IT小王</title><meta name="description" content="Hadoop学习笔记（三）MapReduce"><meta name="keywords" content="Hadoop,MapReduce"><meta name="author" content="IT小王"><meta name="copyright" content="IT小王"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.svg"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Hadoop学习笔记（三）MapReduce"><meta name="twitter:description" content="Hadoop学习笔记（三）MapReduce"><meta name="twitter:image" content="https://wangbowen.cn/postImages/HadoopCover.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Hadoop学习笔记（三）MapReduce"><meta property="og:url" content="https://wangbowen.cn/2020/02/16/Hadoop%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89MapReduce/"><meta property="og:site_name" content="IT小王"><meta property="og:description" content="Hadoop学习笔记（三）MapReduce"><meta property="og:image" content="https://wangbowen.cn/postImages/HadoopCover.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://wangbowen.cn/2020/02/16/Hadoop%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89MapReduce/"><link rel="prev" title="Nginx快速上手" href="https://wangbowen.cn/2020/02/22/Nginx%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/"><link rel="next" title="Hadoop学习笔记（二）HDFS" href="https://wangbowen.cn/2020/02/13/Hadoop%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89HDFS/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"ELVDUY5WGR","apiKey":"55783f8f2945106559981cc355ad5d57","indexName":"hexoSearch","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"http://wangbowen.cn/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"title":"Snackbar.bookmark.title","message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"top-center"},
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">IT小王</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">37</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">23</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">28</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Hadoop学习笔记（三）MapReduce"><span class="toc_mobile_items-text">Hadoop学习笔记（三）MapReduce</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#一、简介"><span class="toc_mobile_items-text">一、简介</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#二、MR编程（JAVA）"><span class="toc_mobile_items-text">二、MR编程（JAVA）</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-1-编写程序流程简介"><span class="toc_mobile_items-text">2.1 编写程序流程简介</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-2-MR程序入门示例（WordCount）"><span class="toc_mobile_items-text">2.2 MR程序入门示例（WordCount）</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-3-运行MR程序"><span class="toc_mobile_items-text">2.3 运行MR程序</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#本地模式（IDEA）"><span class="toc_mobile_items-text">本地模式（IDEA）</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#集群模式"><span class="toc_mobile_items-text">集群模式</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-4-Chain链式MR编程"><span class="toc_mobile_items-text">2.4 Chain链式MR编程</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#简介"><span class="toc_mobile_items-text">简介</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#使用"><span class="toc_mobile_items-text">使用</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#三、MR工作流程"><span class="toc_mobile_items-text">三、MR工作流程</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3-1-整体流程简介"><span class="toc_mobile_items-text">3.1 整体流程简介</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3-2-job提交流程解析"><span class="toc_mobile_items-text">3.2 job提交流程解析</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#本地模式"><span class="toc_mobile_items-text">本地模式</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#YARN框架简介"><span class="toc_mobile_items-text">YARN框架简介</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#集群模式-1"><span class="toc_mobile_items-text">集群模式</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#四、Shuffle机制（map后reduce前）"><span class="toc_mobile_items-text">四、Shuffle机制（map后reduce前）</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#4-1流程简介"><span class="toc_mobile_items-text">4.1流程简介</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#MapTask阶段"><span class="toc_mobile_items-text">MapTask阶段</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#ReduceTask阶段"><span class="toc_mobile_items-text">ReduceTask阶段</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#4-2-Partitioner分区"><span class="toc_mobile_items-text">4.2 Partitioner分区</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#简介-1"><span class="toc_mobile_items-text">简介</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#自定义"><span class="toc_mobile_items-text">自定义</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#4-3-Combiner-合成（可选组件）"><span class="toc_mobile_items-text">4.3 Combiner 合成（可选组件）</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#简介-2"><span class="toc_mobile_items-text">简介</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#自定义-1"><span class="toc_mobile_items-text">自定义</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#4-4-排序对比器"><span class="toc_mobile_items-text">4.4 排序对比器</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#简介-3"><span class="toc_mobile_items-text">简介</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#自定义-2"><span class="toc_mobile_items-text">自定义</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#4-5-分组"><span class="toc_mobile_items-text">4.5 分组</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#简介-4"><span class="toc_mobile_items-text">简介</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#自定义-3"><span class="toc_mobile_items-text">自定义</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#五、计数器"><span class="toc_mobile_items-text">五、计数器</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#六、序列化（自定义类）"><span class="toc_mobile_items-text">六、序列化（自定义类）</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#七、排序"><span class="toc_mobile_items-text">七、排序</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#7-1-全排序"><span class="toc_mobile_items-text">7.1 全排序</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#7-2-倒排序"><span class="toc_mobile_items-text">7.2 倒排序</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#7-3-二次排序"><span class="toc_mobile_items-text">7.3 二次排序</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Hadoop学习笔记（三）MapReduce"><span class="toc-text">Hadoop学习笔记（三）MapReduce</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、简介"><span class="toc-text">一、简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、MR编程（JAVA）"><span class="toc-text">二、MR编程（JAVA）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-编写程序流程简介"><span class="toc-text">2.1 编写程序流程简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-MR程序入门示例（WordCount）"><span class="toc-text">2.2 MR程序入门示例（WordCount）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-运行MR程序"><span class="toc-text">2.3 运行MR程序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#本地模式（IDEA）"><span class="toc-text">本地模式（IDEA）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#集群模式"><span class="toc-text">集群模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-Chain链式MR编程"><span class="toc-text">2.4 Chain链式MR编程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#简介"><span class="toc-text">简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用"><span class="toc-text">使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、MR工作流程"><span class="toc-text">三、MR工作流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-整体流程简介"><span class="toc-text">3.1 整体流程简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-job提交流程解析"><span class="toc-text">3.2 job提交流程解析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#本地模式"><span class="toc-text">本地模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#YARN框架简介"><span class="toc-text">YARN框架简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#集群模式-1"><span class="toc-text">集群模式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、Shuffle机制（map后reduce前）"><span class="toc-text">四、Shuffle机制（map后reduce前）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1流程简介"><span class="toc-text">4.1流程简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MapTask阶段"><span class="toc-text">MapTask阶段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ReduceTask阶段"><span class="toc-text">ReduceTask阶段</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-Partitioner分区"><span class="toc-text">4.2 Partitioner分区</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#简介-1"><span class="toc-text">简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#自定义"><span class="toc-text">自定义</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-Combiner-合成（可选组件）"><span class="toc-text">4.3 Combiner 合成（可选组件）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#简介-2"><span class="toc-text">简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#自定义-1"><span class="toc-text">自定义</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-排序对比器"><span class="toc-text">4.4 排序对比器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#简介-3"><span class="toc-text">简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#自定义-2"><span class="toc-text">自定义</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-分组"><span class="toc-text">4.5 分组</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#简介-4"><span class="toc-text">简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#自定义-3"><span class="toc-text">自定义</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、计数器"><span class="toc-text">五、计数器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#六、序列化（自定义类）"><span class="toc-text">六、序列化（自定义类）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#七、排序"><span class="toc-text">七、排序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-全排序"><span class="toc-text">7.1 全排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-倒排序"><span class="toc-text">7.2 倒排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-二次排序"><span class="toc-text">7.3 二次排序</span></a></li></ol></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(/postImages/HadoopCover.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">Hadoop学习笔记（三）MapReduce</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2020-02-16<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-02-16</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><i class="fa fa-angle-right fa-fw" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/Hadoop/">Hadoop</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="Hadoop学习笔记（三）MapReduce"><a href="#Hadoop学习笔记（三）MapReduce" class="headerlink" title="Hadoop学习笔记（三）MapReduce"></a>Hadoop学习笔记（三）MapReduce</h1><h2 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h2><p>一个存储在分布式文件系统中的大规模数据集，会被切分成许多独立的小数据块，这些小数据块可以被多个Map任务并行处理。Map任务生成的结果会作为Reduce任务的输入，并最终由Reduce输出最终结果。（MapReduce的应用程序不一定要用JAVA来写）</p>
<h2 id="二、MR编程（JAVA）"><a href="#二、MR编程（JAVA）" class="headerlink" title="二、MR编程（JAVA）"></a>二、MR编程（JAVA）</h2><h3 id="2-1-编写程序流程简介"><a href="#2-1-编写程序流程简介" class="headerlink" title="2.1 编写程序流程简介"></a>2.1 编写程序流程简介</h3><p>在JAVA编程中，MR程序编写主要流程分为：</p>
<ol>
<li>编写Mapper类</li>
<li>编写Reduce类</li>
<li>编写Job启动类</li>
<li>打包运行</li>
</ol>
<h3 id="2-2-MR程序入门示例（WordCount）"><a href="#2-2-MR程序入门示例（WordCount）" class="headerlink" title="2.2 MR程序入门示例（WordCount）"></a>2.2 MR程序入门示例（WordCount）</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.wangbowen.mr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.GenericOptionsParser;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * WordCount class</span></span><br><span class="line"><span class="comment"> * 单词计数MapReduce程序</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BoWenWang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/2/17 0:37</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCount</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// 获取运行参数(其中至少一个输入路径以及一个输出路径)</span></span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        String[] remainingArgs = (<span class="keyword">new</span> GenericOptionsParser(conf, args)).getRemainingArgs();</span><br><span class="line">        <span class="keyword">if</span> (remainingArgs.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">"Usage: WordCount &lt;in&gt; [&lt;in&gt;...] &lt;out&gt;"</span>);</span><br><span class="line">            System.exit(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 创建Job任务</span></span><br><span class="line">        Job job = Job.getInstance(conf, <span class="string">"WordCount"</span>);</span><br><span class="line">        <span class="comment">// 设置Jar包运行的类</span></span><br><span class="line">        job.setJarByClass(WordCount<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">// 设置Map和Reduce类</span></span><br><span class="line">        job.setMapperClass(WcMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setReducerClass(WcReduce<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">// 设置reduce输出的键值对类型(这里其实map和reduce同时设置了)</span></span><br><span class="line">        job.setOutputKeyClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputValueClass(LongWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">// 设置map输出的键值对类型(如果map和reduce输出键值对类型一样，下面两个就不用设置)</span></span><br><span class="line">        job.setMapOutputKeyClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setMapOutputValueClass(LongWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">// 指定原始数据存放在路径</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; remainingArgs.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            FileInputFormat.addInputPath(job, <span class="keyword">new</span> Path(remainingArgs[i]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 指定处理输出数据存放路径</span></span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(remainingArgs[remainingArgs.length - <span class="number">1</span>]));</span><br><span class="line">        <span class="comment">// 将job提交给集群运行</span></span><br><span class="line">        System.exit(job.waitForCompletion(<span class="keyword">true</span>) ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Map类</span></span><br><span class="line"><span class="comment">     * 4个泛型中，前两个是指定mapper输入数据的类型。输入输出都是以键值对形式封装的。</span></span><br><span class="line"><span class="comment">     * 其中LongWritable是对Long的封装，Text是对String的封装。</span></span><br><span class="line"><span class="comment">     * 默认情况下，框架传递给我的mapper的输入数据中，key是要处理文本中一行的起始偏移量，这一行的内容作为value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WcMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">LongWritable</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> LongWritable NUM = <span class="keyword">new</span> LongWritable(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            <span class="comment">// 将这一行的内容转为String类型字符串</span></span><br><span class="line">            String line = value.toString();</span><br><span class="line">            <span class="comment">// 拆分单词</span></span><br><span class="line">            String[] words = line.split(<span class="string">" "</span>);</span><br><span class="line">            <span class="keyword">for</span> (String word : words) &#123;</span><br><span class="line">                <span class="comment">// 将每个单词输出为以键值对形式</span></span><br><span class="line">                context.write(<span class="keyword">new</span> Text(word), NUM);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Reduce类</span></span><br><span class="line"><span class="comment">     * 框架在Map处理之后，将所有键值对分组，传递一个组，调用一次reduce方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WcReduce</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">LongWritable</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;LongWritable&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            <span class="keyword">long</span> count = <span class="number">0L</span>;</span><br><span class="line">            <span class="comment">// 遍历累加求和</span></span><br><span class="line">            <span class="keyword">for</span> (LongWritable value : values) &#123;</span><br><span class="line">                count += value.get();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 输出这一个单词的统计结果</span></span><br><span class="line">            context.write(key, <span class="keyword">new</span> LongWritable(count));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<h3 id="2-3-运行MR程序"><a href="#2-3-运行MR程序" class="headerlink" title="2.3 运行MR程序"></a>2.3 运行MR程序</h3><h4 id="本地模式（IDEA）"><a href="#本地模式（IDEA）" class="headerlink" title="本地模式（IDEA）"></a>本地模式（IDEA）</h4><ol>
<li><p>创建文本文件作为输入数据文件</p>
<p><a href="/postImages/MR1.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR1.png" class="lazyload"></a></p>
</li>
<li><p>设置运行参数，根据自己实际的目录（这里采用IDEA编译器）</p>
<p><a href="/postImages/MR2.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR2.png" class="lazyload"></a></p>
<p><a href="/postImages/MR3.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR3.png" class="lazyload"></a></p>
</li>
<li><p>运行main函数</p>
<p><a href="/postImages/MR4.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR4.png" class="lazyload"></a></p>
</li>
</ol>
<h4 id="集群模式"><a href="#集群模式" class="headerlink" title="集群模式"></a>集群模式</h4><ol>
<li><p>修改pom文件，添加打包方式</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>打包程序</p>
<p><a href="/postImages/MR5.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR5.png" class="lazyload"></a></p>
</li>
<li><p>将打包文件上传到集群上，或者设置一个共享文件夹让本地和集群联通</p>
<p><a href="/postImages/MR6.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR6.png" class="lazyload"></a></p>
</li>
<li><p>启动HDFS，并在HDFS创建输入文件</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; 启动HDFS</span><br><span class="line">$start-dfs.sh</span><br><span class="line">$start-yarn.sh</span><br><span class="line">&#x2F;&#x2F; 创建输入文件</span><br><span class="line">$hdfs dfs -mkdir -p &#x2F;user&#x2F;wbw&#x2F;mr&#x2F;word_count</span><br><span class="line">$hdfs dfs -put ~&#x2F;sfs&#x2F;words.txt &#x2F;user&#x2F;wbw&#x2F;mr&#x2F;word_count&#x2F;</span><br><span class="line">&#x2F;&#x2F; 运行命令</span><br><span class="line">&#x2F;&#x2F; 解析：$hadoop jar &lt;jar文件&gt; &lt;全路径主类名&gt; &lt;HDFS输入数据源目录可以多个&gt; &lt;HDFS输出结果目录&gt;</span><br><span class="line">$hadoop jar Hadoop-1.0-SNAPSHOT.jar cn.wangbowen.mr.WordCount hdfs:&#x2F;&#x2F;s201&#x2F;user&#x2F;wbw&#x2F;mr&#x2F;word_count&#x2F; hdfs:&#x2F;&#x2F;s201&#x2F;user&#x2F;wbw&#x2F;mr&#x2F;word_count&#x2F;out</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>打开WEB-UI（主机名:8088）最终会显示成功</p>
<p><a href="/postImages/MR7.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR7.png" class="lazyload"></a></p>
</li>
<li><p>查看结果</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[wbw@s201 &#x2F;home&#x2F;wbw&#x2F;sfs]$hdfs dfs -cat &#x2F;user&#x2F;wbw&#x2F;mr&#x2F;word_count&#x2F;out&#x2F;part-r-00000</span><br><span class="line">apple	1</span><br><span class="line">hello	3</span><br><span class="line">tom	2</span><br><span class="line">world	2</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>可能会遇到的问题</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Please check whether your etc&#x2F;hadoop&#x2F;mapred-site.xml contains the below configuration:</span><br><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;name&gt;yarn.app.mapreduce.am.env&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;value&gt;HADOOP_MAPRED_HOME&#x3D;$&#123;full path of your hadoop distribution directory&#125;&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;name&gt;mapreduce.map.env&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;value&gt;HADOOP_MAPRED_HOME&#x3D;$&#123;full path of your hadoop distribution directory&#125;&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;name&gt;mapreduce.reduce.env&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;value&gt;HADOOP_MAPRED_HOME&#x3D;$&#123;full path of your hadoop distribution directory&#125;&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br></pre></td></tr></table></figure></div>

<p>解决方法：按错误提示，在mapred-site.xml配置文件中添加hadoop根目录</p>
</li>
</ol>
<h3 id="2-4-Chain链式MR编程"><a href="#2-4-Chain链式MR编程" class="headerlink" title="2.4 Chain链式MR编程"></a>2.4 Chain链式MR编程</h3><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>有时候一个MR程序，并不能解决我们的问题，因而需要多个MR程序配合使用，前一个MR的输出结果作为后一个MR程序的输入。又或者我们写完一个MR以后，过一段时间，需要增加一些条件，那我们还要重新对代码进行编码。这样工作量无疑大大增加了，因此，现在有一个ChainMapper和ChainReducer来帮我们处理这些问题，使MR程序可重用。</p>
<p>一个MR程序，是由MapTask和ReduceTask两个阶段组成。在MapTask阶段可以有&gt;=1个Mapper类，在ReduceTask阶段，可以由一个Reduce类+[&gt;=0个Mapper类]组成。因此，一个MR程序可以有如下顺序执行结构：[Mapper] –&gt; [Mapper] –&gt; [Mapper] –&gt; [Reduce] –&gt; [Mapper] –&gt; [Mapper]（但是，最基本的必须由一个Mapper+一个Reduce组成）这样就组成了一条链子样子的链式处理。同理，第一个Mapper的输出，可以作为第二Mapper的输入，第三个Mapper的输出可以作为Reduce的输入，Reduce的输出可以作为后面Mapper的输入，以此类推。</p>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><ol>
<li><p>需求：统计单词数量（要求长度大于等于5，且总数大于3）</p>
</li>
<li><p>数据准备：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">apple apple apple apple apple </span><br><span class="line">pink pink pink pink pink </span><br><span class="line">hello hello hello</span><br></pre></td></tr></table></figure></div>

<p>可以看到apple符合要求，pink总数符合但是长度不符合，hello长度符合但是总数不合符，因此最终输出结果应该是《apple 5》</p>
</li>
<li><p>编写Mapper类</p>
<ul>
<li><p>WCChain（主类）</p>
<p>！！！特别要注意ChainMapper和ChainReducer调用，别复制太快了！！！</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * WCChain class</span></span><br><span class="line"><span class="comment"> * MR主类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BoWenWang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/2/21 23:43</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WCChain</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// 获取运行参数(其中至少一个输入路径以及一个输出路径)</span></span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        String[] remainingArgs = (<span class="keyword">new</span> GenericOptionsParser(conf, args)).getRemainingArgs();</span><br><span class="line">        <span class="keyword">if</span> (remainingArgs.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">"Usage: WordCountChain &lt;in&gt; [&lt;in&gt;...] &lt;out&gt;"</span>);</span><br><span class="line">            System.exit(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 创建Job任务</span></span><br><span class="line">        Job job = Job.getInstance(conf, <span class="string">"WordCountChain"</span>);</span><br><span class="line">        <span class="comment">// 设置Jar包运行的类</span></span><br><span class="line">        job.setJarByClass(WCChain<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 添加MapperTasks(注意是ChainMapper调用！)</span></span><br><span class="line"><span class="comment">         * addMapper参数介绍：</span></span><br><span class="line"><span class="comment">         * #1 ：Job任务</span></span><br><span class="line"><span class="comment">         * #2 ：Mapper类</span></span><br><span class="line"><span class="comment">         * #3、4 ：输入数据K、V类型类</span></span><br><span class="line"><span class="comment">         * #5、6 ：输出数据K、V类型类</span></span><br><span class="line"><span class="comment">         * #7 ：配置文件（可以用上面的 conf）</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        ChainMapper.addMapper(job, Mapper1<span class="class">.<span class="keyword">class</span>, <span class="title">LongWritable</span>.<span class="title">class</span>, <span class="title">Text</span>.<span class="title">class</span>, <span class="title">Text</span>.<span class="title">class</span>, <span class="title">IntWritable</span>.<span class="title">class</span>, <span class="title">conf</span>)</span>;</span><br><span class="line">        ChainMapper.addMapper(job, Mapper2<span class="class">.<span class="keyword">class</span>, <span class="title">Text</span>.<span class="title">class</span>, <span class="title">IntWritable</span>.<span class="title">class</span>, <span class="title">Text</span>.<span class="title">class</span>, <span class="title">IntWritable</span>.<span class="title">class</span>, <span class="title">conf</span>)</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 添加ReduceTasks(注意都是ChainReducer调用！)</span></span><br><span class="line"><span class="comment">         * setReducer参数介绍：</span></span><br><span class="line"><span class="comment">         * #1 ：Job任务</span></span><br><span class="line"><span class="comment">         * #2 ：Reduce类</span></span><br><span class="line"><span class="comment">         * #3、4 ：输入数据K、V类型类</span></span><br><span class="line"><span class="comment">         * #5、6 ：输出数据K、V类型类</span></span><br><span class="line"><span class="comment">         * #7 ：配置文件（可以用上面的 conf）</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        ChainReducer.setReducer(job, Reduce1<span class="class">.<span class="keyword">class</span>, <span class="title">Text</span>.<span class="title">class</span>, <span class="title">IntWritable</span>.<span class="title">class</span>, <span class="title">Text</span>.<span class="title">class</span>, <span class="title">IntWritable</span>.<span class="title">class</span>, <span class="title">conf</span>)</span>;</span><br><span class="line">        ChainReducer.addMapper(job, Mapper3<span class="class">.<span class="keyword">class</span>, <span class="title">Text</span>.<span class="title">class</span>, <span class="title">IntWritable</span>.<span class="title">class</span>, <span class="title">Text</span>.<span class="title">class</span>, <span class="title">IntWritable</span>.<span class="title">class</span>, <span class="title">conf</span>)</span>;</span><br><span class="line">        <span class="comment">// 指定原始数据存放在路径</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; remainingArgs.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            FileInputFormat.addInputPath(job, <span class="keyword">new</span> Path(remainingArgs[i]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 指定处理输出数据存放路径</span></span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(remainingArgs[remainingArgs.length - <span class="number">1</span>]));</span><br><span class="line">        <span class="comment">// 将job提交给集群运行</span></span><br><span class="line">        System.exit(job.waitForCompletion(<span class="keyword">true</span>) ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>Mapper、Reduce类</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Mapper1 class</span></span><br><span class="line"><span class="comment"> * 第一个Mapper处理文本文件输入数据，输出所有K-V：单词-1</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BoWenWang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/2/21 23:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mapper1</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> IntWritable SUM = <span class="keyword">new</span> IntWritable(<span class="number">1</span>);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        String line = value.toString();</span><br><span class="line">        String[] words = line.split(<span class="string">" "</span>);</span><br><span class="line">        <span class="keyword">for</span> (String word : words) &#123;</span><br><span class="line">            context.write(<span class="keyword">new</span> Text(word), SUM);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Mapper2 class</span></span><br><span class="line"><span class="comment"> * 第二个Mapper过滤长度&lt;5的单词</span></span><br><span class="line"><span class="comment"> * 输入为Mapper1的输出，即K-V：单词-1</span></span><br><span class="line"><span class="comment"> * 输出为K-V：单词-1</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BoWenWang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/2/21 23:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mapper2</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">Text</span>, <span class="title">IntWritable</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(Text key, IntWritable value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key.toString().length() &gt;= <span class="number">5</span>) &#123;</span><br><span class="line">            context.write(key, value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Reducer1 class</span></span><br><span class="line"><span class="comment"> * 这是MR唯一一个Reduce类，用来统计各单词总数</span></span><br><span class="line"><span class="comment"> * 输入为Mapper2的输入K-V: 单词-1</span></span><br><span class="line"><span class="comment"> * 输出为K-V: 单词-总数</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BoWenWang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/2/21 23:38</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Reduce1</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">IntWritable</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (IntWritable value : values) &#123;</span><br><span class="line">            count += value.get();</span><br><span class="line">        &#125;</span><br><span class="line">        context.write(key, <span class="keyword">new</span> IntWritable(count));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Mapper3 class</span></span><br><span class="line"><span class="comment"> * 第三个Mapper过滤总数小于等于3的单词</span></span><br><span class="line"><span class="comment"> * 输入为Reduce的输出，即K-V：单词-总数</span></span><br><span class="line"><span class="comment"> * 输出为K-V：符合要求的单词-总数</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BoWenWang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/2/21 23:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mapper3</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">Text</span>, <span class="title">IntWritable</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(Text key, IntWritable value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (value.get() &gt; <span class="number">3</span>) &#123;</span><br><span class="line">            context.write(key, value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>




</li>
</ul>
</li>
</ol>
<h2 id="三、MR工作流程"><a href="#三、MR工作流程" class="headerlink" title="三、MR工作流程"></a>三、MR工作流程</h2><h3 id="3-1-整体流程简介"><a href="#3-1-整体流程简介" class="headerlink" title="3.1 整体流程简介"></a>3.1 整体流程简介</h3><ol>
<li><p>MapReduce框架使用InputFormat模块做Map前的预处理，然后将输入文件分为逻辑上的多个InputSplit（只是一个逻辑概念，并没有实际切分。只是记录了要处理数据的位置和长度）</p>
</li>
<li><p>通过RecordReader根据InputSplit中的信息来处理具体记录，加载数据并转化为合适Map任务读取的键值对给Map任务</p>
</li>
<li><p>Map任务根据用户自定义的映射规则，输出一系列&lt;key,value&gt;作为中间结果</p>
</li>
<li><p>经过Shuffle（对Map的输出进行一定的分区、排序、合并、归并等操作），得到&lt;key,value-list&gt;形式的中间结果</p>
</li>
<li><p>Reduce以&lt;key,value-list&gt;中间结果作为输入，执行用户自定义的逻辑，输出结果给OutputFormat模块</p>
</li>
<li><p>OutputFormat模块会验证输出目录是否已经存在以及输出结果类型是否符合配置文件中的配置类型。都满足就会输出结果到分布式文件系统</p>
</li>
</ol>
<h3 id="3-2-job提交流程解析"><a href="#3-2-job提交流程解析" class="headerlink" title="3.2 job提交流程解析"></a>3.2 job提交流程解析</h3><h4 id="本地模式"><a href="#本地模式" class="headerlink" title="本地模式"></a>本地模式</h4><p>这里我们对2.2中的代码进行断点追踪来分析一下本地运行流程：</p>
<ol>
<li><p>创建外部Job(mapreduce.Job),设置配置信息</p>
<p>即为2.2中main方法里面的内容。</p>
</li>
</ol>
<ol start="2">
<li><p>通过jobsubmitter作业提交器将job.xml + split等文件写入临时目录</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%901.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%901.png" class="lazyload"></a></p>
<p>我们可以看到这里创建了一个临时目录，用来放提交任务临时文件。</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%902.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%902.png" class="lazyload"></a></p>
<p>接着将编写的job信息拷贝和配置文件方法。</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%903.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%903.png" class="lazyload"></a></p>
<p>创建提交任务文件。</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%904.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%904.png" class="lazyload"></a></p>
<p>计算切片数量（map数量）,下一行是写入到conf对象。</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%905.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%905.png" class="lazyload"></a></p>
<p>将配置信息写入到提交作业文件。</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%906.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%906.png" class="lazyload"></a></p>
<p>打开临时文件目录，打开job.xml发现，程序里面给job.set都是给job.xml配置作业属性。同时目录下还有切片信息。</p>
</li>
</ol>
<ol start="3">
<li><p>通过jobSubmitter提交job给localJobRunner</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%907.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%907.png" class="lazyload"></a></p>
</li>
</ol>
<ol start="4">
<li><p>LocalJobRunner将外部Job 转换成成内部Job</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%908.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%908.png" class="lazyload"></a></p>
<p>这个job是内部类，在LocalJobRunner。如果是集群就是YARNRunner。所以在提交作业的时候，先把job转换成内部类。</p>
</li>
</ol>
<ol start="5">
<li><p>内部Job线程，开放分线程执行job</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%909.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%909.png" class="lazyload"></a></p>
<p>进入内部类job的构造函数，发现最底下有一个start函数。因此这个内部类是个线程类，找到它的run方法，打断点进入发现确实开启一个分线程。</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%9011.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%9011.png" class="lazyload"></a></p>
<p>进入run函数中，发现这个变量就是用来存放MAP后的键值对。</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%9012.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%9012.png" class="lazyload"></a></p>
<p>接着发现，这里可以看到mapRunnables为map的线程数，以及reduce任务数。</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%9014.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%9014.png" class="lazyload"></a></p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%9015.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%9015.png" class="lazyload"></a></p>
<p>继续查看发现它又进行了，获取切片信息，获得map任务集合，以及运行map任务，以及之后的reduce任务。</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%9013.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%9013.png" class="lazyload"></a></p>
<p>从结构上可以看到，Job内部类其实又有两个线程类。</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%9016.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%9016.png" class="lazyload"></a></p>
<p>进入Map的runTask，可以看到这里又有一个submit，以及后面的debug值，发现这又开了一个线程，这其实就是上面结构图中MapTaskRunnable线程类。</p>
</li>
</ol>
<ol start="6">
<li><p>job执行线程分别计算Map和reduce任务信息，并通过线程池孵化新线程执行MR任务。</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%9017.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%9017.png" class="lazyload"></a></p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%9018.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%9018.png" class="lazyload"></a></p>
<p>可以看到这里创建了Map任务对象和，以及船舰输出文件，map毕竟也是要将结果输出给reduce的。最后又执行了run方法。</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%9019.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%9019.png" class="lazyload"></a></p>
<p>进入run后，发现有一个runNewMapper。</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%9020.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%9020.png" class="lazyload"></a></p>
<p>进入runNewMapper。发现了上下文对象名（可以联想到自己写mapper的时候那个参数context），反射工具库类，以及这个mapper对象值是自己写的Map类名信息。</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%9021.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%9021.png" class="lazyload"></a></p>
<p>最后这个mapper执行了run方法（通过线程池孵化新线程执行MR任务）。</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%9022.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%9022.png" class="lazyload"></a></p>
<p>进入run方法。这里有3个过程，其中我们只编写了第二部分的内容，即自己的mapper类。</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%9023.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%9023.png" class="lazyload"></a></p>
<p>继续打断点，发现程序进入到了我们自己写的方法里面了，可以看出我们写的代码逻辑到现在才进行运行。</p>
</li>
</ol>
<ol start="7">
<li><p>接下来reduce的过程也是类似的</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%9024.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%9024.png" class="lazyload"></a></p>
<p>这里有一些排序等操作。</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%9025.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%9025.png" class="lazyload"></a></p>
<p>可以看到在执行reduce前有一个shuffle的操作。</p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%9026.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%9026.png" class="lazyload"></a></p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%9027.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%9027.png" class="lazyload"></a></p>
<p><a href="/postImages/MR%E8%A7%A3%E6%9E%9028.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/MR%E8%A7%A3%E6%9E%9028.png" class="lazyload"></a></p>
<p>至此程序就结束了，然后输出结果。</p>
</li>
</ol>
<h4 id="YARN框架简介"><a href="#YARN框架简介" class="headerlink" title="YARN框架简介"></a>YARN框架简介</h4><p>用于资源调度，包含ResourceManager和NodeManager。</p>
<p>意义：让Hadoop变得更加通用，让很多的运算框架都能够在YARN集群上跑起来。只要让他们实现AppMaster接口就可以了。</p>
<p><a href="/postImages/yarn%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E7%AE%80%E5%9B%BE.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/yarn%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E7%AE%80%E5%9B%BE.png" class="lazyload"></a></p>
<h4 id="集群模式-1"><a href="#集群模式-1" class="headerlink" title="集群模式"></a>集群模式</h4><p>这里提供一份他人的详解，感觉讲的挺详细的（<a href="https://github.com/heibaiying/BigData-Notes/blob/master/notes/Hadoop-YARN.md）" target="_blank" rel="noopener">https://github.com/heibaiying/BigData-Notes/blob/master/notes/Hadoop-YARN.md）</a></p>
<p>job提交流程图：</p>
<a href="/postImages/JOB提交1.png" data-fancybox="group" data-caption="undefined" class="fancybox"><img data-src="/postImages/JOB提交1.png" class="lazyload"></a>

<p>job提交流程解析：</p>
<ol>
<li><p>当我们编写好MapReduce程序打成一个jar包，运行Main方法，其中有个job.waitforcompletion()会创建一个客户端实例RunJar。</p>
</li>
<li><p>这个RunJar会找ResourceManager通信，申请执行一个application应用（这里在客户端叫job，在yarn里叫application）。ResourceManager返回application相关资源提交的路径starting-dir（还记得本地模式下那个tmp开头的临时目录吗，就是这个）和为本application产生的applicationID（这步的主要目的就是拿到这个ID）。</p>
</li>
<li><p>RunJar把相应的jar包和配置文件提交到HDFS临时目录下（还记得本地模式下那个/tmp/…/job.xml还有切片信息等吗）。为什么要放在HDFS中？因为HDFS是共享系统，每个节点都能访问到里面的内容。</p>
<p><a href="/postImages/JOB%E6%8F%90%E4%BA%A42.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/JOB%E6%8F%90%E4%BA%A42.png" class="lazyload"></a></p>
<p>因为之前运行过一个MR程序，可以查看HDFS文件列表，发现确实有/tmp/…开头目录的文件信息。</p>
</li>
<li><p>最后, 通过调用 submitApplication() 来提交作业到ResourceManager。</p>
</li>
<li><p>ResourceManager会找到集群中一台NodeManager在其容器（container）中启动程序主进程（MRAppMaster）。并向ResourceManager注册，当程序运行完成后，会向ResourceManager注销自己，回收资源。</p>
</li>
<li><p>然后MRAppMaster会先去HDFS中检索资源。为什么要检索?HDFS中有切片信息，这代表了需要多少个并发执行的Map任务。</p>
</li>
<li><p>然后向ResourceManager询问分配资源列表（即，哪些节点可用。比如需要30个节点，那么ResourceManager就会给你这30个节点的信息）,接着就可以去联系这些节点的NodeManager。</p>
</li>
<li><p>然后这些NodeManager就会启动yarn子进程，yarn子进程因为拿到了切片信息，就可以去HDFS检索对应的资源。</p>
</li>
<li><p>拿到资源后就可以开启MapTask或者ReduceTask。</p>
</li>
</ol>
<h2 id="四、Shuffle机制（map后reduce前）"><a href="#四、Shuffle机制（map后reduce前）" class="headerlink" title="四、Shuffle机制（map后reduce前）"></a>四、Shuffle机制（map后reduce前）</h2><h3 id="4-1流程简介"><a href="#4-1流程简介" class="headerlink" title="4.1流程简介"></a>4.1流程简介</h3><p><a href="/postImages/shuffle.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/shuffle.png" class="lazyload"></a></p>
<h4 id="MapTask阶段"><a href="#MapTask阶段" class="headerlink" title="MapTask阶段"></a>MapTask阶段</h4><ol>
<li><p>输入数据和执行Map任务。</p>
<p>Map任务接受&lt;key,value&gt;作为输入，按一定规则以&lt;key,value&gt;输出。</p>
</li>
<li><p>写入缓存。</p>
<p>每个Map任务都会分配一个缓存，Map输出结果先写到缓存中，当缓存中积累一定数量的结果后才一次性写入磁盘。</p>
</li>
<li><p>溢写（分区、排序、合并）</p>
<p>缓存容量默认是100M（可以在io.sort.mb属性修改），随着任务的进行，缓存不断增大，当达到溢写比例0.8（io.sort.spill.percent属性）后，先将80M写入磁盘（即，一个后台线程把内容写到（spill）硬盘的指定目录（mapred.local.dir）下的新建的一个溢出写文件），20M空间继续提供Map结果写入。</p>
<p>但是，在溢写到磁盘前，缓存中的数据会先被分区。默认采用Hash函数对key哈希后再用Reduce任务数量进行取模。这样就可以把Map结果均匀分配给R个Reduce任务并行处理。</p>
<p>对于每个分区内的所有键值对，会根据key在内存中排序。然后进行可选的合并（如：两个&lt;”test”,1&gt;就会合并成&lt;”test”,2&gt;。一般用于累加、最大值等场景）</p>
<p>经过以上步骤，就可以写入磁盘了。</p>
</li>
<li><p>文件归并</p>
<p>每次溢写都会产生一个新的溢写文件，最终在Map任务全部结束之前，会对所有溢写文件中的数据进行归并成一个大的溢写文件（归并：两个&lt;”test”,1&gt;就会合并成&lt;”test”,{1,1}&gt;）    </p>
</li>
</ol>
<p><a href="/postImages/mapTask.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/mapTask.png" class="lazyload"></a></p>
<h4 id="ReduceTask阶段"><a href="#ReduceTask阶段" class="headerlink" title="ReduceTask阶段"></a>ReduceTask阶段</h4><ol>
<li><p>“领取”数据</p>
<p>Map端的Shuffle过程结束后，数据在Map的机器上，所以Map任务完成后会通知Reduce来领取数据到Reduce端（Reduce会从多个Map机器领回属于自己分区的数据，一个分区可能有多个不同的key）。</p>
</li>
<li><p>归并数据</p>
<p>归并发生在Reduce任务执行前，在领回的数据中，具有相同key的键值对会进行归并。</p>
</li>
<li><p>把数据输入给Reduce任务，并产生最终结果。</p>
</li>
</ol>
<h3 id="4-2-Partitioner分区"><a href="#4-2-Partitioner分区" class="headerlink" title="4.2 Partitioner分区"></a>4.2 Partitioner分区</h3><h4 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h4><p>我们知道，Map处理完数据，会往分区里面放，分区中不同区传给不同的reduce。而分区的个数是由reduce任务数决定的。Hadoop中自带了一个默认的分区类HashPartitioner，它继承了Partitioner类，提供了一个getPartition的方法：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashPartitioner</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">Partitioner</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashPartitioner</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// 按Key进行hash的分区函数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPartition</span><span class="params">(K key, V value, <span class="keyword">int</span> numReduceTasks)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (key.hashCode() &amp; <span class="number">2147483647</span>) % numReduceTasks;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>为什么要自定义分区函数？是为了解决数据倾斜（比如有3个reduce，第一个分区有98%的数据，第二个有2%，第三个0%，这样就造成了资源的不合理分配，浪费资源），合理的分配是有助于reduce计算的。</p>
<h4 id="自定义"><a href="#自定义" class="headerlink" title="自定义"></a>自定义</h4><ol>
<li><p>定义分区类</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * YearPartitioner class</span></span><br><span class="line"><span class="comment"> * 分区类</span></span><br><span class="line"><span class="comment"> * 根据年份分区</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BoWenWang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/2/21 16:38</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YearPartitioner</span> <span class="keyword">extends</span> <span class="title">Partitioner</span>&lt;<span class="title">ComboKey</span>, <span class="title">NullWritable</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPartition</span><span class="params">(ComboKey comboKey, NullWritable nullWritable, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> year = comboKey.getYear();</span><br><span class="line">        <span class="keyword">return</span> year % i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>程序中配置使用分区类</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="comment">//设置分区</span></span><br><span class="line">   job.setPartitionerClass(YearPartitioner<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"><span class="comment">// 设置reduce任务数量（要和Partitioner分数数量保持一致，多了会产生空文件，少了会报错）</span></span><br><span class="line">   job.setNumReduceTasks(<span class="number">3</span>);</span><br></pre></td></tr></table></figure></div>



</li>
</ol>
<h3 id="4-3-Combiner-合成（可选组件）"><a href="#4-3-Combiner-合成（可选组件）" class="headerlink" title="4.3 Combiner 合成（可选组件）"></a>4.3 Combiner 合成（可选组件）</h3><h4 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h4><p>继承了Reducer 任何的Reducer类都能被他使用，它并不是类，只有一个setCombinerClass方法。</p>
<p>作用相当于Map端的Reducer ，预先化简。为了减少网络带宽将Map端发出的的数据进行聚合 并不是所有的都可以用combiner </p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCombinerClass</span><span class="params">(Class&lt;? extends Reducer&gt; cls)</span> <span class="keyword">throws</span> IllegalStateException </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.ensureState(Job.JobState.DEFINE);</span><br><span class="line">    <span class="keyword">this</span>.conf.setClass(<span class="string">"mapreduce.job.combine.class"</span>, cls, Reducer<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<h4 id="自定义-1"><a href="#自定义-1" class="headerlink" title="自定义"></a>自定义</h4><ol>
<li><p>定义一个类继承Reducer。</p>
</li>
<li><p>在主函数中调用方法</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">job.setCombinerClass(WcReduce<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure></div>




</li>
</ol>
<h3 id="4-4-排序对比器"><a href="#4-4-排序对比器" class="headerlink" title="4.4 排序对比器"></a>4.4 排序对比器</h3><h4 id="简介-3"><a href="#简介-3" class="headerlink" title="简介"></a>简介</h4><p>reduce前将Map传来的key-value对进行排序，可以自定义排序对比器。</p>
<h4 id="自定义-2"><a href="#自定义-2" class="headerlink" title="自定义"></a>自定义</h4><ol>
<li><p>定义对比器类（注意要有一个构造函数来注册）</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ComboKeyComparator class</span></span><br><span class="line"><span class="comment"> * 利用这个排序对比器来进行对自定义类的排序</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BoWenWang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/2/21 18:08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ComboKeyComparator</span> <span class="keyword">extends</span> <span class="title">WritableComparator</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 注册</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">ComboKeyComparator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(ComboKey<span class="class">.<span class="keyword">class</span>, <span class="title">true</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 因此ComboKey类实现了自己的比较方法，直接调用</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(WritableComparable a, WritableComparable b)</span> </span>&#123;</span><br><span class="line">        ComboKey o1 = (ComboKey)a;</span><br><span class="line">        ComboKey o2 = (ComboKey)b;</span><br><span class="line">        <span class="keyword">return</span> o1.compareTo(o2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>main函数中添加设置</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 设置排序对比起</span></span><br><span class="line">job.setSortComparatorClass(ComboKeyComparator<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure></div>



</li>
</ol>
<h3 id="4-5-分组"><a href="#4-5-分组" class="headerlink" title="4.5 分组"></a>4.5 分组</h3><h4 id="简介-4"><a href="#简介-4" class="headerlink" title="简介"></a>简介</h4><p>对于在同一个reduce中的key-value对，相同的key被分到一组，即&lt;key,&lt; value1,value2,…,valueN&gt;&gt;形式。这里可以自定义分组。</p>
<h4 id="自定义-3"><a href="#自定义-3" class="headerlink" title="自定义"></a>自定义</h4><ol>
<li><p>定义分组类</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * YearGroupingComparator class</span></span><br><span class="line"><span class="comment"> * 分组对比器：用于将一个reduce中不同key进行分组，相同的key将</span></span><br><span class="line"><span class="comment"> * 其值都放到一个iterator中</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BoWenWang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/2/21 18:04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YearGroupingComparator</span> <span class="keyword">extends</span> <span class="title">WritableComparator</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 注册</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">YearGroupingComparator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(ComboKey<span class="class">.<span class="keyword">class</span>, <span class="title">true</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(WritableComparable a, WritableComparable b)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        ComboKey o1 = (ComboKey)a;</span><br><span class="line">        ComboKey o2 = (ComboKey)b;</span><br><span class="line">        <span class="keyword">return</span> o1.getYear() - o2.getYear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>在main函数中配置</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 设置分组对比器</span></span><br><span class="line">job.setGroupingComparatorClass(YearGroupingComparator<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure></div>



</li>
</ol>
<h2 id="五、计数器"><a href="#五、计数器" class="headerlink" title="五、计数器"></a>五、计数器</h2><p>有时候我们需要在map和reduce的时候打印一些统计信息，但是将程序放到集群上运行时候，如果用sout来输出的话，是在不同机器上的logs文件下。因此我们需要一个计数器来进行统计。</p>
<ol>
<li><p>添加计数器代码</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">context.getCounter(<span class="string">"m"</span>, <span class="string">"WCMapper.map"</span>).increment(<span class="number">1</span>);</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>程序运行结果输出报告：</p>
<p><a href="/postImages/%E8%AE%A1%E6%95%B0%E5%99%A8.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/%E8%AE%A1%E6%95%B0%E5%99%A8.png" class="lazyload"></a></p>
</li>
</ol>
<h2 id="六、序列化（自定义类）"><a href="#六、序列化（自定义类）" class="headerlink" title="六、序列化（自定义类）"></a>六、序列化（自定义类）</h2><p>有时候原本的数据结构不够用了（如下面的二次排序），这时就需要我们定义自己需要的结果来进行编程操作。注意事项如下：</p>
<ol>
<li>实现WritableComparable接口（相当于分别实现了Writable和Comparable接口）。</li>
<li>重写write、readFields序列化、但序列化方法，要注意顺序一致。</li>
<li>提供一个无参构造函数，用于反射。</li>
<li>重写compareTo方法，用于当把类当成key时的比较。</li>
<li>重写toString方法，当Reduce输出类型为自定义类时，可以以指定样式输出到文本文件。</li>
</ol>
<p>代码示例：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ComboKey class</span></span><br><span class="line"><span class="comment"> * 自定义组合累类（用于充当key）</span></span><br><span class="line"><span class="comment"> * 相当于自定义序列化:</span></span><br><span class="line"><span class="comment"> *  实现WritableComparable接口，相当于分别实现了Writable和Comparable接口</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BoWenWang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/2/21 16:26</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ComboKey</span> <span class="keyword">implements</span> <span class="title">WritableComparable</span>&lt;<span class="title">ComboKey</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// 年份</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> year;</span><br><span class="line">    <span class="comment">// 温度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> temp;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 要提供一个无参构造函数，用于反射</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ComboKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ComboKey</span><span class="params">(<span class="keyword">int</span> year, <span class="keyword">int</span> temp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.year = year;</span><br><span class="line">        <span class="keyword">this</span>.temp = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getYear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> year;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setYear</span><span class="params">(<span class="keyword">int</span> year)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.year = year;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTemp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTemp</span><span class="params">(<span class="keyword">int</span> temp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.temp = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 比较函数用于排序：</span></span><br><span class="line"><span class="comment">     * 如果年份相同，温度降序;如果温度相同，年份升序</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(ComboKey o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (o.getYear() == <span class="keyword">this</span>.year) &#123;</span><br><span class="line">            <span class="keyword">return</span> o.getTemp() - <span class="keyword">this</span>.temp;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.year - o.getYear();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 序列化</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(DataOutput dataOutput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        dataOutput.writeInt(<span class="keyword">this</span>.year);</span><br><span class="line">        dataOutput.writeInt(<span class="keyword">this</span>.temp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 反序列化</span></span><br><span class="line"><span class="comment">     * 注意：</span></span><br><span class="line"><span class="comment">     *      序列化和反序列化的顺序要一致</span></span><br><span class="line"><span class="comment">     *      要提供一个无参构造函数，用于反射</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readFields</span><span class="params">(DataInput dataInput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.year = dataInput.readInt();</span><br><span class="line">        <span class="keyword">this</span>.temp = dataInput.readInt();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<h2 id="七、排序"><a href="#七、排序" class="headerlink" title="七、排序"></a>七、排序</h2><h3 id="7-1-全排序"><a href="#7-1-全排序" class="headerlink" title="7.1 全排序"></a>7.1 全排序</h3><p>全排序的实现方式：</p>
<ol>
<li><p>定义一个reduce (适合数据量少，存在数据倾斜问题)</p>
</li>
<li><p>自定义分区类（手动按照key的值划分分区，存在数据倾斜问题）</p>
</li>
<li><p>使用Hadoop提供的TotalOrderPartitioner + (对inputFormat)RandomSampler（采样器）</p>
<p>随机采样。抽取样本数，计算出区间值，将区间值写入分区文件，分区文件就是一个序列文件，这个序列文件只有key没有value(null)</p>
<p>代码示例：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MaxTempApp</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        conf.set(<span class="string">"fs.defaultFS"</span>,<span class="string">"file:///"</span>);</span><br><span class="line">        Job job = Job.getInstance(conf);</span><br><span class="line">        <span class="comment">//设置job的各种属性</span></span><br><span class="line">        job.setJobName(<span class="string">"MaxTempApp"</span>);                        <span class="comment">//作业名称</span></span><br><span class="line">        job.setJarByClass(MaxTempApp<span class="class">.<span class="keyword">class</span>)</span>;                 <span class="comment">//搜索类</span></span><br><span class="line">        job.setInputFormatClass(SequenceFileInputFormat<span class="class">.<span class="keyword">class</span>)</span>; <span class="comment">//设置输入格式</span></span><br><span class="line">        <span class="comment">//添加输入路径</span></span><br><span class="line">        FileInputFormat.addInputPath(job,<span class="keyword">new</span> Path(args[<span class="number">0</span>]));</span><br><span class="line">        <span class="comment">//设置输出路径</span></span><br><span class="line">        FileOutputFormat.setOutputPath(job,<span class="keyword">new</span> Path(args[<span class="number">1</span>]));</span><br><span class="line">        job.setMapperClass(MaxTempMapper<span class="class">.<span class="keyword">class</span>)</span>;             <span class="comment">//mapper类</span></span><br><span class="line">        job.setReducerClass(MaxTempReducer<span class="class">.<span class="keyword">class</span>)</span>;           <span class="comment">//reducer类</span></span><br><span class="line">        job.setMapOutputKeyClass(IntWritable<span class="class">.<span class="keyword">class</span>)</span>;        <span class="comment">//</span></span><br><span class="line">        job.setMapOutputValueClass(IntWritable<span class="class">.<span class="keyword">class</span>)</span>;      <span class="comment">//</span></span><br><span class="line">        job.setOutputKeyClass(IntWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputValueClass(IntWritable<span class="class">.<span class="keyword">class</span>)</span>;         <span class="comment">//</span></span><br><span class="line">        <span class="comment">// -------------------------------------------------------------------        </span></span><br><span class="line">        <span class="comment">// 创建随机采样器对象</span></span><br><span class="line">        <span class="comment">// freq:每个key被选中的概率</span></span><br><span class="line">        <span class="comment">// numSapmple:抽取样本的总数</span></span><br><span class="line">        <span class="comment">// maxSplitSampled:最大采样切片数</span></span><br><span class="line">        InputSampler.Sampler&lt;IntWritable, IntWritable&gt; sampler =</span><br><span class="line">                <span class="keyword">new</span> InputSampler.RandomSampler&lt;IntWritable, IntWritable&gt;(<span class="number">1</span>, <span class="number">6000</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="comment">// 将sample数据写入分区文件.</span></span><br><span class="line">        TotalOrderPartitioner.setPartitionFile(conf,<span class="keyword">new</span> Path(<span class="string">"file:///d:/mr/par.lst"</span>));</span><br><span class="line">        <span class="comment">// 设置全排序分区类</span></span><br><span class="line">        job.setPartitionerClass(TotalOrderPartitioner<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setNumReduceTasks(<span class="number">3</span>);                           <span class="comment">//reduce个数</span></span><br><span class="line">        InputSampler.writePartitionFile(job, sampler);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//job.waitForCompletion(true);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>注意事项：</p>
<ol>
<li>TotalOrderPartitioner        //全排序分区类,读取外部生成的分区文件确定区间。</li>
<li>使用时采样代码在最后端,否则会出现错误。</li>
<li>分区文件设置，设置的job的配置对象，不要是之前的conf.<br>TotalOrderPartitioner.setPartitionFile(job.getConfiguration(),new Path(“d:/mr/par.lst”));</li>
<li>输入格式最好要序列文件，如果采用文本输入格式，采样的是偏移量那将没有意义</li>
</ol>
</li>
</ol>
<h3 id="7-2-倒排序"><a href="#7-2-倒排序" class="headerlink" title="7.2 倒排序"></a>7.2 倒排序</h3><p>K-V对调</p>
<h3 id="7-3-二次排序"><a href="#7-3-二次排序" class="headerlink" title="7.3 二次排序"></a>7.3 二次排序</h3><p>编程步骤：</p>
<ol start="0">
<li><p>数据准备</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2000 12</span><br><span class="line">2007 11</span><br><span class="line">2002 20</span><br><span class="line">2000 15</span><br><span class="line">2001 10</span><br><span class="line">2002 10</span><br><span class="line">2003 20</span><br><span class="line">2004 11</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>需求：需要对value排序</p>
</li>
<li><p>自定义key（代码序列化章节）</p>
</li>
<li><p>自定义分区类,按照年份分区（代码shuffle章节）</p>
</li>
<li><p>定义Key排序对比器（代码shuffle章节）</p>
</li>
<li><p>编写Mapper、Reduce、Main类</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * YearTopTemp class</span></span><br><span class="line"><span class="comment"> * 每年最高温度</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BoWenWang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/2/21 16:47</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YearTopTemp</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// 获取运行参数(其中至少一个输入路径以及一个输出路径)</span></span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        String[] remainingArgs = (<span class="keyword">new</span> GenericOptionsParser(conf, args)).getRemainingArgs();</span><br><span class="line">        <span class="keyword">if</span> (remainingArgs.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">"Usage: YearTopTemp &lt;in&gt; [&lt;in&gt;...] &lt;out&gt;"</span>);</span><br><span class="line">            System.exit(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 创建Job任务</span></span><br><span class="line">        Job job = Job.getInstance(conf, <span class="string">"YearTopTemp"</span>);</span><br><span class="line">        <span class="comment">// 设置Jar包运行的类</span></span><br><span class="line">        job.setJarByClass(YearTopTemp<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">// 设置Map和Reduce类</span></span><br><span class="line">        job.setMapperClass(MyMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setReducerClass(MyReduce<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">// 设置reduce输出的键值对类型(这里其实map和reduce同时设置了)</span></span><br><span class="line">        job.setOutputKeyClass(IntWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputValueClass(IntWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">// 设置map输出的键值对类型(如果map和reduce输出键值对类型一样，下面两个就不用设置)</span></span><br><span class="line">        job.setMapOutputKeyClass(ComboKey<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setMapOutputValueClass(NullWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">// 指定原始数据存放在路径</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; remainingArgs.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            FileInputFormat.addInputPath(job, <span class="keyword">new</span> Path(remainingArgs[i]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 指定处理输出数据存放路径</span></span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(remainingArgs[remainingArgs.length - <span class="number">1</span>]));</span><br><span class="line">        <span class="comment">//设置分区</span></span><br><span class="line">        job.setPartitionerClass(YearPartitioner<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setNumReduceTasks(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">// 设置排序对比器</span></span><br><span class="line">        job.setSortComparatorClass(ComboKeyComparator<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">// 设置分组对比器</span></span><br><span class="line">        job.setGroupingComparatorClass(YearGroupingComparator<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">// 将job提交给集群运行</span></span><br><span class="line">        System.exit(job.waitForCompletion(<span class="keyword">true</span>) ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Map类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">ComboKey</span>, <span class="title">NullWritable</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            String line = value.toString();</span><br><span class="line">            String[] words = line.split(<span class="string">" "</span>);</span><br><span class="line"></span><br><span class="line">            context.write(<span class="keyword">new</span> ComboKey(Integer.parseInt(words[<span class="number">0</span>]),Integer.parseInt(words[<span class="number">1</span>])), NullWritable.get());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Reduce类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyReduce</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">ComboKey</span>, <span class="title">NullWritable</span>, <span class="title">IntWritable</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(ComboKey key, Iterable&lt;NullWritable&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            context.write(<span class="keyword">new</span> IntWritable(key.getYear()), <span class="keyword">new</span> IntWritable(key.getTemp()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



</li>
</ol>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">IT小王</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://wangbowen.cn/2020/02/16/Hadoop%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89MapReduce/">https://wangbowen.cn/2020/02/16/Hadoop%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89MapReduce/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://wangbowen.cn">IT小王</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Hadoop/">Hadoop    </a><a class="post-meta__tags" href="/tags/MapReduce/">MapReduce    </a></div><div class="post_share"><div class="social-share" data-image="/postImages/HadoopCover.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/02/22/Nginx%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/"><img class="prev_cover lazyload" data-src="/postImages/NginxCover.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>Nginx快速上手</span></div></a></div><div class="next-post pull_right"><a href="/2020/02/13/Hadoop%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89HDFS/"><img class="next_cover lazyload" data-src="/postImages/HadoopCover.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>Hadoop学习笔记（二）HDFS</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/02/13/Hadoop学习笔记（一）Hadoop集群/" title="Hadoop学习笔记（一）Hadoop集群"><img class="relatedPosts_cover lazyload"data-src="/postImages/HadoopCover.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-13</div><div class="relatedPosts_title">Hadoop学习笔记（一）Hadoop集群</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/13/Hadoop学习笔记（二）HDFS/" title="Hadoop学习笔记（二）HDFS"><img class="relatedPosts_cover lazyload"data-src="/postImages/HadoopCover.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-13</div><div class="relatedPosts_title">Hadoop学习笔记（二）HDFS</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/24/Hadoop学习笔记（四）数据的输入与输出/" title="Hadoop学习笔记（四）数据的输入与输出"><img class="relatedPosts_cover lazyload"data-src="/postImages/HadoopCover.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-24</div><div class="relatedPosts_title">Hadoop学习笔记（四）数据的输入与输出</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/13/Hadoop学习笔记（零）前期准备/" title="Hadoop学习笔记（一）前期准备"><img class="relatedPosts_cover lazyload"data-src="/postImages/HadoopCover.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-13</div><div class="relatedPosts_title">Hadoop学习笔记（一）前期准备</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = false == true ? true : false;
var verify = false == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'iYYoev4NDSyr3HqlY1VVCTIV-gzGzoHsz',
  appKey:'Hli8dWTFUKrXj9FnhnSQUvRe',
  placeholder:'快来评论吖！ヾﾉ≧∀≦)o',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10',
  lang:'en',
  recordIP: true
});</script></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By IT小王</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="icp"><a href="http://www.beian.miit.gov.cn" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"><span>闽ICP备18027071号-1</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="ribbon" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/canvas-nest.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>