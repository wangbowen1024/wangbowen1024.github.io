<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Hadoop学习笔记（一）Hadoop集群 | IT小王</title><meta name="description" content="Hadoop学习笔记（一）Hadoop集群"><meta name="keywords" content="Hadoop"><meta name="author" content="IT小王"><meta name="copyright" content="IT小王"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.svg"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Hadoop学习笔记（一）Hadoop集群"><meta name="twitter:description" content="Hadoop学习笔记（一）Hadoop集群"><meta name="twitter:image" content="https://wangbowen.cn/postImages/HadoopCover.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Hadoop学习笔记（一）Hadoop集群"><meta property="og:url" content="https://wangbowen.cn/2020/02/13/Hadoop%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89Hadoop%E9%9B%86%E7%BE%A4/"><meta property="og:site_name" content="IT小王"><meta property="og:description" content="Hadoop学习笔记（一）Hadoop集群"><meta property="og:image" content="https://wangbowen.cn/postImages/HadoopCover.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://wangbowen.cn/2020/02/13/Hadoop%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89Hadoop%E9%9B%86%E7%BE%A4/"><link rel="prev" title="Hadoop学习笔记（二）HDFS" href="https://wangbowen.cn/2020/02/13/Hadoop%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89HDFS/"><link rel="next" title="Hadoop学习笔记（一）前期准备" href="https://wangbowen.cn/2020/02/13/Hadoop%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E9%9B%B6%EF%BC%89%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"ELVDUY5WGR","apiKey":"55783f8f2945106559981cc355ad5d57","indexName":"hexoSearch","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"http://wangbowen.cn/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"title":"Snackbar.bookmark.title","message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"top-center"},
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">IT小王</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">40</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">25</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">29</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Hadoop学习笔记（一）Hadoop集群"><span class="toc_mobile_items-text">Hadoop学习笔记（一）Hadoop集群</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#一、介绍"><span class="toc_mobile_items-text">一、介绍</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#二、伪分布式搭建"><span class="toc_mobile_items-text">二、伪分布式搭建</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#三、完全分布式搭建"><span class="toc_mobile_items-text">三、完全分布式搭建</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#四、启动命令"><span class="toc_mobile_items-text">四、启动命令</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#4-1-批量启动节点"><span class="toc_mobile_items-text">4.1 批量启动节点</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#4-2-单独启动节点"><span class="toc_mobile_items-text">4.2 单独启动节点</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#五、节点的服役与退役"><span class="toc_mobile_items-text">五、节点的服役与退役</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#5-1-前期准备"><span class="toc_mobile_items-text">5.1 前期准备</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#5-2-添加新节点"><span class="toc_mobile_items-text">5.2 添加新节点</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#5-3-退役节点"><span class="toc_mobile_items-text">5.3 退役节点</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#5-4-黑白名单"><span class="toc_mobile_items-text">5.4 黑白名单</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#六、配置第二名称节点"><span class="toc_mobile_items-text">六、配置第二名称节点</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#七、Hadoop端口介绍"><span class="toc_mobile_items-text">七、Hadoop端口介绍</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Hadoop学习笔记（一）Hadoop集群"><span class="toc-text">Hadoop学习笔记（一）Hadoop集群</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、介绍"><span class="toc-text">一、介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、伪分布式搭建"><span class="toc-text">二、伪分布式搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、完全分布式搭建"><span class="toc-text">三、完全分布式搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、启动命令"><span class="toc-text">四、启动命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-批量启动节点"><span class="toc-text">4.1 批量启动节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-单独启动节点"><span class="toc-text">4.2 单独启动节点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、节点的服役与退役"><span class="toc-text">五、节点的服役与退役</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-前期准备"><span class="toc-text">5.1 前期准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-添加新节点"><span class="toc-text">5.2 添加新节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-退役节点"><span class="toc-text">5.3 退役节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-黑白名单"><span class="toc-text">5.4 黑白名单</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#六、配置第二名称节点"><span class="toc-text">六、配置第二名称节点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#七、Hadoop端口介绍"><span class="toc-text">七、Hadoop端口介绍</span></a></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(/postImages/HadoopCover.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">Hadoop学习笔记（一）Hadoop集群</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2020-02-13<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-02-13</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><i class="fa fa-angle-right fa-fw" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/Hadoop/">Hadoop</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="Hadoop学习笔记（一）Hadoop集群"><a href="#Hadoop学习笔记（一）Hadoop集群" class="headerlink" title="Hadoop学习笔记（一）Hadoop集群"></a>Hadoop学习笔记（一）Hadoop集群</h1><h2 id="一、介绍"><a href="#一、介绍" class="headerlink" title="一、介绍"></a>一、介绍</h2><p>Hadoop集群有三种模式：</p>
<ul>
<li>本地模式：即系统自身的文件系统。</li>
<li>伪分布式模式：即在一台机子上运行所有角色。</li>
<li>完全分布式模式：根据划分，不同机子拥有不同的角色来进行协同工作。</li>
</ul>
<h2 id="二、伪分布式搭建"><a href="#二、伪分布式搭建" class="headerlink" title="二、伪分布式搭建"></a>二、伪分布式搭建</h2><ol>
<li><p>建虚拟机</p>
</li>
<li><p>配置联网</p>
<ul>
<li><p>查看当前网卡名称 (ip addr)</p>
</li>
<li><p>进入网络配置文件的目录(cd /etc/sysconfig/network-scripts) (ls)</p>
</li>
<li><p>编辑网络配置文件(vi ifcfg-ens33)</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">修改配置文件：</span><br><span class="line">BOOTPROTO&#x3D;static</span><br><span class="line">ONBOOT&#x3D;yes</span><br><span class="line">添加：</span><br><span class="line">IPADDR&#x3D;本机IP</span><br><span class="line">NETMASK&#x3D;255.255.255.0</span><br><span class="line">GATEWAY&#x3D;NAT模式网关IP</span><br><span class="line">DNS1&#x3D;8.8.8.8</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>再重新启动网络配置(service network restart)</p>
</li>
<li><p>测试网络是否畅通(本地PING 虚拟机IP，虚拟机ping外网)</p>
</li>
</ul>
</li>
<li><p>更改主机名</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;hostname</span><br><span class="line">将里面的内容替换为需要的主机名</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>配置主机名(域名)映射文件，整个集群都写上去</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;hosts</span><br><span class="line">新建：</span><br><span class="line">127.0.0.1 localhost</span><br><span class="line">192.168.xxx.xxx XXX</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>安装JDK1.8，配置环境变量（Hadoop是JAVA开发）</p>
</li>
<li><p>解压Hadoop（这里使用hadoop-3.0）</p>
</li>
<li><p>修改Hadoop配置文件 </p>
<ul>
<li>修改 vi hadoop-env.sh 的JAVA环境变量为自己的</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">export JAVA_HOME=/home/hadoop/app/jdk1.8.0_131</span><br></pre></td></tr></table></figure></div>

<ul>
<li>修改 vi core-site.xml <div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- hdfs://xxx其中hdfs是协议，xxx是核心主机，默认端口号9000 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://weekend01:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置Hadoop的临时工作目录存放数据，默认/tmp/hadoop-$&#123;user.name&#125; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/hadoop/app/hadoop-3.1.2/tmp/<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></div></li>
<li>修改 vi hdfs-site.xml <div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定HDFS副本的数量，默认是3份。副本数不要超过节点数量。这里只有一台机器所以写1 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></div></li>
<li>修改 vi mapred-site.xml<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定mr运行时框架，这里指定在yarn上，默认是local在本地跑 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></div></li>
<li>修改 vi yarn-site.xml <div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定YARN的老大（ResourceManager）的地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>weekend01<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- reduce获取数据的方式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
</li>
</ul>
</li>
<li><p>关闭防火墙（CentOS7如下）</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">关闭防火墙</span></span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line"><span class="meta">#</span><span class="bash">关闭防火墙随开机启动</span></span><br><span class="line">systemctl disable firewalld.service</span><br><span class="line">--------------------------------------------------------------------------</span><br><span class="line"><span class="meta">$</span><span class="bash">&gt;sudo systemctl <span class="built_in">enable</span> firewalld.service	//<span class="string">"开机启动"</span>启用</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&gt;sudo systemctl <span class="built_in">disable</span> firewalld.service	//<span class="string">"开机自启"</span>禁用</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&gt;sudo systemctl start firewalld.service	//启动防火墙</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&gt;sudo systemctl stop firewalld.service		//停止防火墙</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&gt;sudo systemctl status firewalld.service	//查看防火墙状态</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>配置Hadoop环境变量</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export JAVA_HOME&#x3D;&#x2F;home&#x2F;hadoop&#x2F;app&#x2F;jdk1.8.0_131</span><br><span class="line">export HADOOP_HOME&#x3D;&#x2F;home&#x2F;hadoop&#x2F;app&#x2F;hadoop-3.1.2</span><br><span class="line">export PATH&#x3D;$PATH:$JAVA_HOME&#x2F;bin:$PATH:$HADOOP_HOME&#x2F;bin:$PATH:$HADOOP_HOME&#x2F;sbin</span><br><span class="line">更新配置</span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>启动Hadoop</p>
<ul>
<li><p>初始化</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">首次启动Hadoop集群时，必须对其HDFS进行格式化。格式化本质上是进行一些清理和准备工作，因为此时的HDFS在物理上还是不存在的。格式化只能在主角色（NameNode）所在的机器上进行。</span><br><span class="line"></span><br><span class="line">hdfs namenode -format</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>启动</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hdfs(namenode + datanode + secondarynamenode):  </span><br><span class="line">start-dfs.sh</span><br><span class="line">yarn资源管理调度(resourcemanager + nodemanager):  </span><br><span class="line">start-yarn.sh</span><br><span class="line"></span><br><span class="line">TIP:如果遇到Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password).问题，搜索文章：在CentOS 7中配置免密码登录SSH时遇到错误</span><br><span class="line"></span><br><span class="line">还有一个是启动所有进程（不推荐）</span><br><span class="line">start-all.sh</span><br><span class="line">关闭所有进程</span><br><span class="line">stop-all.sh</span><br></pre></td></tr></table></figure></div>
</li>
</ul>
<ol start="11">
<li><p>查看进程</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$&gt; jps</span><br><span class="line">显示5个进程：</span><br><span class="line">2960 ResourceManager</span><br><span class="line">3392 Jps</span><br><span class="line">2550 DataNode</span><br><span class="line">3079 NodeManager</span><br><span class="line">2440 NameNode（仅仅是一个目录的功能）</span><br><span class="line">2734 SecondaryNameNode</span><br></pre></td></tr></table></figure></div>
</li>
</ol>
<ul>
<li><p>通过WEB-UI查看</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">角色							   URL						说明</span><br><span class="line">NameNode						http:&#x2F;&#x2F;NN_host:port&#x2F;	默认端口是9870</span><br><span class="line">ResourceManager					http:&#x2F;&#x2F;RM_host:port&#x2F;	默认端口是8088</span><br><span class="line">MapReduce Job History Server	http:&#x2F;&#x2F;JHS_host:port&#x2F;	默认端口是19888</span><br></pre></td></tr></table></figure></div>
</li>
</ul>
</li>
<li><p>配置SSH</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1)检查是否安装了ssh相关软件包(openssh-server + openssh-clients + openssh)</span><br><span class="line">$yum list installed | grep ssh</span><br><span class="line"></span><br><span class="line">2)检查是否启动了sshd进程</span><br><span class="line">$&gt;ps -Af | grep sshd</span><br><span class="line"></span><br><span class="line">3)在client侧生成公私秘钥对。</span><br><span class="line">$&gt;ssh-keygen -t rsa -P &#39;&#39; -f ~&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line"></span><br><span class="line">4)生成~&#x2F;.ssh文件夹，里面有id_rsa(私钥) + id_rsa.pub(公钥)</span><br><span class="line"></span><br><span class="line">5)追加公钥到~&#x2F;.ssh&#x2F;authorized_keys文件中(文件名、位置固定)</span><br><span class="line">$&gt;cd ~&#x2F;.ssh</span><br><span class="line">$&gt;cat id_rsa.pub &gt;&gt; authorized_keys</span><br><span class="line"></span><br><span class="line">6)修改authorized_keys的权限为644.</span><br><span class="line">$&gt;chmod 644 authorized_keys</span><br><span class="line"></span><br><span class="line">7)测试</span><br><span class="line">$&gt;ssh localhost</span><br></pre></td></tr></table></figure></div>



</li>
</ol>
<h2 id="三、完全分布式搭建"><a href="#三、完全分布式搭建" class="headerlink" title="三、完全分布式搭建"></a>三、完全分布式搭建</h2><ol>
<li><p>将上述伪分布式机器克隆3台出来（其中01作为名称节点，02-04作为数据节点），记得设置文件夹共享（默认是关闭：设置，选项，文件夹共享，总是启用）</p>
</li>
<li><p>修改hostname和ip地址文件还有host映射</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$sudo vi &#x2F;etc&#x2F;hostname # 修改主机名</span><br><span class="line"></span><br><span class="line">$sudo vi &#x2F;etc&#x2F;hosts # 新增4台机子的IP以及对应的主机名</span><br><span class="line"></span><br><span class="line">$sudo vi &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-ensxxxx   # IP文件目录</span><br><span class="line"></span><br><span class="line">$service network restart  # 重启网络服务</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>重新配置SSH</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1) 在s201机器上删除所有机器上的SSH文件</span><br><span class="line">$ssh s203 rm -r &#x2F;home&#x2F;wbw&#x2F;.ssh&#x2F;*</span><br><span class="line">$ssh s204 rm -r &#x2F;home&#x2F;wbw&#x2F;.ssh&#x2F;*</span><br><span class="line">$ssh s205 rm -r &#x2F;home&#x2F;wbw&#x2F;.ssh&#x2F;*</span><br><span class="line">$rm -r .ssh&#x2F;*</span><br><span class="line"></span><br><span class="line">2）s201机器生成密钥对，并通过SCP发送给其余机器(不用sudo)</span><br><span class="line">$ssh-keygen -t rsa -P &#39;&#39; -f ~&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line"># 追加公钥到authorized_keys</span><br><span class="line">$cat id_rsa.pub &gt;&gt; authorized_keys</span><br><span class="line">$chmod 644 authorized_keys</span><br><span class="line"># 分发</span><br><span class="line">$scp id_rsa.pub wbw@s201:&#x2F;home&#x2F;wbw&#x2F;.ssh&#x2F;authorized_keys</span><br><span class="line">$scp id_rsa.pub wbw@s202:&#x2F;home&#x2F;wbw&#x2F;.ssh&#x2F;authorized_keys</span><br><span class="line">$scp id_rsa.pub wbw@s203:&#x2F;home&#x2F;wbw&#x2F;.ssh&#x2F;authorized_keys</span><br><span class="line">$scp id_rsa.pub wbw@s204:&#x2F;home&#x2F;wbw&#x2F;.ssh&#x2F;authorized_keys</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>配置完全分布（目录为${hadoop_home}/etc/hadoop/）</p>
<ul>
<li><p>core-site.xml（根据集群规划，S201为名称节点）</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://s201/<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--- 配置新的本地目录 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/wbw/hadoop<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>hdfs-site.xml（因为这里有3个数据节点，所以副本改成3）</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>mapred-site.xml（不变）</p>
</li>
<li><p>yarn-site.xml（根据集群规划，S201为resourcemanager）</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>s201<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>slaves（workers）</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">清空里面的所有内容！根据集群规划，数据节点在s202,s203,s204上。然后添加：</span><br><span class="line">s202</span><br><span class="line">s203</span><br><span class="line">s204</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>hadoop-env.sh（Hadoop的JAVA环境，如果之前没有配的化，要记得设置）</p>
</li>
<li><p>将整个配置文件夹分发到其余机器对应的配置文件夹里</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">scp -r full wbw@s202:&#x2F;soft&#x2F;hadoop&#x2F;etc&#x2F;</span><br><span class="line">scp -r full wbw@s203:&#x2F;soft&#x2F;hadoop&#x2F;etc&#x2F;</span><br><span class="line">scp -r full wbw@s204:&#x2F;soft&#x2F;hadoop&#x2F;etc&#x2F;</span><br><span class="line"></span><br><span class="line">!!!注意这里的full是我自己的文件夹，正常应该只有一个名为hadoop的文件夹!!!</span><br></pre></td></tr></table></figure></div>
</li>
</ul>
</li>
<li><p>剩余数据清理</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">TIP:如果之前有用过Hadoop（比如这个是克隆来的，而克隆之前用过了。所以对一些文件进行清理后，重新初始化）</span><br><span class="line"></span><br><span class="line">1)删除临时目录文件</span><br><span class="line">进入主目录下的临时文件夹</span><br><span class="line">$cd &#x2F;tmp</span><br><span class="line">删除hadoop的临时文件（用SSH操作其余机器）</span><br><span class="line">$rm -rf hadoop-wbw</span><br><span class="line">$ssh s202 rm -rf &#x2F;tmp&#x2F;hadoop-wbw</span><br><span class="line">$ssh s203 rm -rf &#x2F;tmp&#x2F;hadoop-wbw</span><br><span class="line">$ssh s204 rm -rf &#x2F;tmp&#x2F;hadoop-wbw</span><br><span class="line"></span><br><span class="line">2)删除Hadoop日志文件</span><br><span class="line">进入Hadoop安装目录下的logs文件夹</span><br><span class="line">$cd &#x2F;soft&#x2F;hadoop&#x2F;logs&#x2F;</span><br><span class="line">删除所有文件（用SSH操作其余机器）</span><br><span class="line">$rm -rf *</span><br><span class="line">$ssh s202 rm -rf &#x2F;soft&#x2F;hadoop&#x2F;logs&#x2F;*</span><br><span class="line">$ssh s203 rm -rf &#x2F;soft&#x2F;hadoop&#x2F;logs&#x2F;*</span><br><span class="line">$ssh s204 rm -rf &#x2F;soft&#x2F;hadoop&#x2F;logs&#x2F;*</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>初始化文件系统并启动</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$hadoop namenode -format</span><br><span class="line">$start-all.sh</span><br><span class="line"># 查看进程</span><br><span class="line">$jps</span><br><span class="line"></span><br><span class="line">s201:</span><br><span class="line">2178 ResourceManager</span><br><span class="line">1964 SecondaryNameNode</span><br><span class="line">2478 Jps</span><br><span class="line">1743 NameNode</span><br><span class="line"></span><br><span class="line">s202:</span><br><span class="line">1825 Jps</span><br><span class="line">1699 NodeManager</span><br><span class="line">1588 DataNode</span><br><span class="line"></span><br><span class="line">s203:</span><br><span class="line">1536 NodeManager</span><br><span class="line">1425 DataNode</span><br><span class="line">1650 Jps</span><br><span class="line"></span><br><span class="line">s204:</span><br><span class="line">1522 NodeManager</span><br><span class="line">1411 DataNode</span><br><span class="line">1636 Jps</span><br><span class="line"></span><br><span class="line">发现启动成功！再次通过WEB-UI查看，发现确实启动成功！(注意关闭防火墙)</span><br></pre></td></tr></table></figure></div>



</li>
</ol>
<h2 id="四、启动命令"><a href="#四、启动命令" class="headerlink" title="四、启动命令"></a>四、启动命令</h2><h3 id="4-1-批量启动节点"><a href="#4-1-批量启动节点" class="headerlink" title="4.1 批量启动节点"></a>4.1 批量启动节点</h3><p>Hadoop的一些启动脚本里面执行的内容（如果启动失败，可以查看日志，即Hadoop安装目录下的logs文件夹）：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$&gt;start-all.sh		&#x2F;&#x2F;start-dfs.sh + start-yarn.sh</span><br><span class="line">$&gt;start-dfs.sh		&#x2F;&#x2F;hadoop-daemon.sh start namenode</span><br><span class="line">					&#x2F;&#x2F;hadoop-daemons.sh start datanode</span><br><span class="line">$&gt;start-yarn.sh		&#x2F;&#x2F;yarn-daemon.sh start resourcemanager</span><br><span class="line">					&#x2F;&#x2F;yarn-daemons.sh start nodemanager</span><br></pre></td></tr></table></figure></div>



<h3 id="4-2-单独启动节点"><a href="#4-2-单独启动节点" class="headerlink" title="4.2 单独启动节点"></a>4.2 单独启动节点</h3><ul>
<li><p>启动s201上的NameNode</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[wbw@s201 &#x2F;soft&#x2F;hadoop&#x2F;sbin]$hadoop-daemon.sh start namenode</span><br><span class="line">WARNING: Use of this script to start HDFS daemons is deprecated.</span><br><span class="line">WARNING: Attempting to execute replacement &quot;hdfs --daemon start&quot; instead.</span><br><span class="line">[wbw@s201 &#x2F;soft&#x2F;hadoop&#x2F;sbin]$xcall.sh &#x2F;soft&#x2F;jdk&#x2F;bin&#x2F;jps</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; s201 : &#x2F;soft&#x2F;jdk&#x2F;bin&#x2F;jps &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">5272 NameNode</span><br><span class="line">5342 Jps</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; s202 : &#x2F;soft&#x2F;jdk&#x2F;bin&#x2F;jps &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2587 Jps</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; s203 : &#x2F;soft&#x2F;jdk&#x2F;bin&#x2F;jps &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2395 Jps</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; s204 : &#x2F;soft&#x2F;jdk&#x2F;bin&#x2F;jps &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2360 Jps</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>在s201上启动所有DataNode</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[wbw@s201 &#x2F;soft&#x2F;hadoop&#x2F;sbin]$hadoop-daemons.sh start datanode</span><br><span class="line">WARNING: Use of this script to start HDFS daemons is deprecated.</span><br><span class="line">WARNING: Attempting to execute replacement &quot;hdfs --workers --daemon start&quot; instead.</span><br><span class="line">[wbw@s201 &#x2F;soft&#x2F;hadoop&#x2F;sbin]$xcall.sh &#x2F;soft&#x2F;jdk&#x2F;bin&#x2F;jps</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; s201 : &#x2F;soft&#x2F;jdk&#x2F;bin&#x2F;jps &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">7019 NameNode</span><br><span class="line">7246 Jps</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; s202 : &#x2F;soft&#x2F;jdk&#x2F;bin&#x2F;jps &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">3837 Jps</span><br><span class="line">3775 DataNode</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; s203 : &#x2F;soft&#x2F;jdk&#x2F;bin&#x2F;jps &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">3494 Jps</span><br><span class="line">3432 DataNode</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; s204 : &#x2F;soft&#x2F;jdk&#x2F;bin&#x2F;jps &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">3459 Jps</span><br><span class="line">3397 DataNode</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>在s202上停止DataNode</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[wbw@s201 &#x2F;soft&#x2F;hadoop&#x2F;sbin]$ssh s202</span><br><span class="line">Last login: Thu Feb 13 18:41:00 2020 from s201</span><br><span class="line">[wbw@s202 &#x2F;home&#x2F;wbw]$hadoop-daemon.sh stop datanode</span><br><span class="line">WARNING: Use of this script to stop HDFS daemons is deprecated.</span><br><span class="line">WARNING: Attempting to execute replacement &quot;hdfs --daemon stop&quot; instead.</span><br><span class="line">[wbw@s202 &#x2F;home&#x2F;wbw]$exit</span><br><span class="line">logout</span><br><span class="line">Connection to s202 closed.</span><br><span class="line">[wbw@s201 &#x2F;soft&#x2F;hadoop&#x2F;sbin]$xcall.sh &#x2F;soft&#x2F;jdk&#x2F;bin&#x2F;jps</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; s201 : &#x2F;soft&#x2F;jdk&#x2F;bin&#x2F;jps &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">7286 Jps</span><br><span class="line">7019 NameNode</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; s202 : &#x2F;soft&#x2F;jdk&#x2F;bin&#x2F;jps &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">3945 Jps</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; s203 : &#x2F;soft&#x2F;jdk&#x2F;bin&#x2F;jps &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">3432 DataNode</span><br><span class="line">3516 Jps</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; s204 : &#x2F;soft&#x2F;jdk&#x2F;bin&#x2F;jps &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">3397 DataNode</span><br><span class="line">3480 Jps</span><br></pre></td></tr></table></figure></div>



</li>
</ul>
<h2 id="五、节点的服役与退役"><a href="#五、节点的服役与退役" class="headerlink" title="五、节点的服役与退役"></a>五、节点的服役与退役</h2><p>在生产环境中，肯定会有新的节点加入，以及旧的节点退出。因此就需要进行一些设置。</p>
<h3 id="5-1-前期准备"><a href="#5-1-前期准备" class="headerlink" title="5.1 前期准备"></a>5.1 前期准备</h3><p>克隆一台虚拟机，模拟一个新的节点，这里选s204克隆到s205，然后对IP、主机名等信息进行设置。再到s201中更新hosts文件。但是，因为是克隆的，所以datanode并不纯净，因此需要进行清理操作。</p>
<ol>
<li><p>进入Hadoop安装目录，清空logs目录下的所有日志文件</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[wbw@s205 &#x2F;soft&#x2F;hadoop&#x2F;logs]$rm -rf *</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>清空Hadoop临时文件目录</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[wbw@s205 &#x2F;home&#x2F;wbw&#x2F;hadoop]$rm -rf *</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>启动datandoe以及nodemanager</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[wbw@s205 &#x2F;home&#x2F;wbw]$hadoop-daemon.sh start datanode</span><br><span class="line">[wbw@s205 &#x2F;home&#x2F;wbw]$yarn-daemon.sh start nodemanager</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>查看进程，发现运行正常</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[wbw@s205 &#x2F;home&#x2F;wbw]$jps</span><br><span class="line">1633 NodeManager</span><br><span class="line">1332 DataNode</span><br><span class="line">1726 Jps</span><br></pre></td></tr></table></figure></div>




</li>
</ol>
<h3 id="5-2-添加新节点"><a href="#5-2-添加新节点" class="headerlink" title="5.2 添加新节点"></a>5.2 添加新节点</h3><ol>
<li><p>创建/修改dfs.include文件（这里暂时称它为白名单，即要想连接上NameNode就必须在这个名单上）中包含新节点名称,该文件在nn的本地目录</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[wbw@s201 &#x2F;soft&#x2F;hadoop&#x2F;etc]$touch dfs.hosts</span><br><span class="line">[wbw@s201 &#x2F;soft&#x2F;hadoop&#x2F;etc]$vi dfs.hosts</span><br><span class="line">添加如下内容：</span><br><span class="line">s202</span><br><span class="line">s203    </span><br><span class="line">s204    </span><br><span class="line">s205	&#x2F;&#x2F;新节点</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>在hdfs-site.xml文件中添加属性</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.hosts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>/soft/hadoop/etc/dfs.hosts<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>在yarn-site.xml文件中添加属性</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.nodes.include-path<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/soft/hadoop/etc/dfs.hosts<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>在NameNode上刷新节点</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$hdfs dfsadmin -refreshNodes</span><br><span class="line">$yarn rmadmin -refreshNodes</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>在slaves(workers)文件中添加新节点ip(主机名)【该文件仅仅是让Hadoop启动的时候，向这些主机发送DataNode启动命令】</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[wbw@s201 &#x2F;soft&#x2F;hadoop&#x2F;etc&#x2F;hadoop]$vi workers</span><br><span class="line">添加如下内容：</span><br><span class="line">s202</span><br><span class="line">s203</span><br><span class="line">s204</span><br><span class="line">s205</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>单独启动新的节点中的datanode以及nodemanager（建议去新节点的机器上执行jps命令，查看进程状态。实验时，一开始新节点的nodemanager是启动的，但是添加完，在NameNode上刷新节点后，莫名停止了）</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$hadoop-daemon.sh start datanode</span><br><span class="line">$yarn-daemon.sh start nodemanager</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>通过WEB-UI查看状态，发现s205添加成功（也可以通过命令$hdfs dfsadmin -report查看）</p>
<p><a href="/postImages/%E6%B7%BB%E5%8A%A0%E8%8A%82%E7%82%B91.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/%E6%B7%BB%E5%8A%A0%E8%8A%82%E7%82%B91.png" class="lazyload"></a></p>
</li>
</ol>
<h3 id="5-3-退役节点"><a href="#5-3-退役节点" class="headerlink" title="5.3 退役节点"></a>5.3 退役节点</h3><ol>
<li><p>添加退役节点的ip到黑名单，不要更新白名单。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[wbw@s201 &#x2F;soft&#x2F;hadoop&#x2F;etc]$touch dfs.hosts.exclude</span><br><span class="line">[wbw@s201 &#x2F;soft&#x2F;hadoop&#x2F;etc]$vi dfs.hosts.exclude</span><br><span class="line">添加如下内容：</span><br><span class="line">s204</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>配置hdfs-site.xml</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.hosts.exclude<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>/soft/hadoop/etc/dfs.hosts.exclude<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>配置yarn-site.xml</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.nodes.exclude-path<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/soft/hadoop/etc/dfs.hosts.exclude<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>刷新NameNode节点</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$hdfs dfsadmin -refreshNodes</span><br><span class="line">$yarn rmadmin -refreshNodes</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>查看WEB-UI状态（也可以通过命令$hdfs dfsadmin -report查看）</p>
<ul>
<li>绿勾消失了（状态为decommisstion in progress）</li>
</ul>
<p><a href="/postImages/%E9%80%80%E5%BD%B91.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/%E9%80%80%E5%BD%B91.png" class="lazyload"></a></p>
<ul>
<li>当所有的要退役的节点都报告为Decommissioned,数据转移工作已经完成。</li>
</ul>
<p><a href="/postImages/%E9%80%80%E5%BD%B92.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/%E9%80%80%E5%BD%B92.png" class="lazyload"></a></p>
</li>
<li><p>从白名单删除节点，并刷新节点</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$hdfs dfsadmin -refreshNodes</span><br><span class="line">$yarn rmadmin -refreshNodes</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>查看WEB-UI，确定退役成功。同时文件块也成功转移。</p>
<p><a href="/postImages/%E9%80%80%E5%BD%B93.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/%E9%80%80%E5%BD%B93.png" class="lazyload"></a></p>
<p><a href="/postImages/%E9%80%80%E5%BD%B94.png" data-fancybox="group" data-caption="avatar" class="fancybox"><img alt="avatar" title="avatar" data-src="/postImages/%E9%80%80%E5%BD%B94.png" class="lazyload"></a></p>
</li>
<li><p>从slaves(workers)文件中删除退役节点</p>
</li>
</ol>
<h3 id="5-4-黑白名单"><a href="#5-4-黑白名单" class="headerlink" title="5.4 黑白名单"></a>5.4 黑白名单</h3><p>在新增和退役节点的时候，有一个黑白名单的设置。这里的黑白名单有一定的优先级：</p>
<p>include        // dfs.hosts<br>exclude        // dfs.hosts.include</p>
<table>
<thead>
<tr>
<th align="center">include</th>
<th align="center">exclude</th>
<th align="center">Interpretation</th>
</tr>
</thead>
<tbody><tr>
<td align="center">No</td>
<td align="center">No</td>
<td align="center">不能连接</td>
</tr>
<tr>
<td align="center">No</td>
<td align="center">Yes</td>
<td align="center">不能连接</td>
</tr>
<tr>
<td align="center">Yes</td>
<td align="center">No</td>
<td align="center">可以连接</td>
</tr>
<tr>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="center">可以连接，将会退役状态</td>
</tr>
</tbody></table>
<p>解释：Yes和No分别代表主机名是否存在于黑白名单中，以及DataNode能否连接到NameNode。</p>
<h2 id="六、配置第二名称节点"><a href="#六、配置第二名称节点" class="headerlink" title="六、配置第二名称节点"></a>六、配置第二名称节点</h2><p>修改hdfs-site.xml文件</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.secondary.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 根据实际主机IP修改 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>s205:9868<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>如果不配置这个属性，那么第二名称节点会和名称节点在一台主机上。</p>
<p>效果：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; s201 : jps &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2790 ResourceManager</span><br><span class="line">3096 Jps</span><br><span class="line">2398 NameNode</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; s202 : jps &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">1780 Jps</span><br><span class="line">1526 DataNode</span><br><span class="line">1662 NodeManager</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; s203 : jps &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">1664 NodeManager</span><br><span class="line">1782 Jps</span><br><span class="line">1529 DataNode</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; s204 : jps &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">1781 Jps</span><br><span class="line">1526 DataNode</span><br><span class="line">1663 NodeManager</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; s205 : jps &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">1767 Jps</span><br><span class="line">1709 SecondaryNameNode</span><br></pre></td></tr></table></figure></div>



<h2 id="七、Hadoop端口介绍"><a href="#七、Hadoop端口介绍" class="headerlink" title="七、Hadoop端口介绍"></a>七、Hadoop端口介绍</h2><p>Hadoop 3 相对于Hadoop 2 在端口号上有一些改变：</p>
<table>
<thead>
<tr>
<th align="center"><strong>分类</strong></th>
<th align="center"><strong>应用</strong></th>
<th align="center"><strong>Haddop 2.x port</strong></th>
<th align="center"><strong>Haddop 3 port</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center">NNPorts</td>
<td align="center">Namenode</td>
<td align="center">8020</td>
<td align="center">9820</td>
</tr>
<tr>
<td align="center">NNPorts</td>
<td align="center">NN HTTP UI</td>
<td align="center">50070</td>
<td align="center">9870</td>
</tr>
<tr>
<td align="center">NNPorts</td>
<td align="center">NN HTTPS UI</td>
<td align="center">50470</td>
<td align="center">9871</td>
</tr>
<tr>
<td align="center">SNN ports</td>
<td align="center">SNN HTTP</td>
<td align="center">50091</td>
<td align="center">9869</td>
</tr>
<tr>
<td align="center">SNN ports</td>
<td align="center">SNN HTTP UI</td>
<td align="center">50090</td>
<td align="center">9868</td>
</tr>
<tr>
<td align="center">DN ports</td>
<td align="center">DN IPC</td>
<td align="center">50020</td>
<td align="center">9867</td>
</tr>
<tr>
<td align="center">DN ports</td>
<td align="center">DN</td>
<td align="center">50010</td>
<td align="center">9866</td>
</tr>
<tr>
<td align="center">DN ports</td>
<td align="center">DN HTTP UI</td>
<td align="center">50075</td>
<td align="center">9864</td>
</tr>
<tr>
<td align="center">DN ports</td>
<td align="center">Namenode</td>
<td align="center">50475</td>
<td align="center">9865</td>
</tr>
</tbody></table>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">IT小王</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://wangbowen.cn/2020/02/13/Hadoop%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89Hadoop%E9%9B%86%E7%BE%A4/">https://wangbowen.cn/2020/02/13/Hadoop%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89Hadoop%E9%9B%86%E7%BE%A4/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://wangbowen.cn">IT小王</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Hadoop/">Hadoop    </a></div><div class="post_share"><div class="social-share" data-image="/postImages/HadoopCover.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/02/13/Hadoop%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89HDFS/"><img class="prev_cover lazyload" data-src="/postImages/HadoopCover.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>Hadoop学习笔记（二）HDFS</span></div></a></div><div class="next-post pull_right"><a href="/2020/02/13/Hadoop%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E9%9B%B6%EF%BC%89%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87/"><img class="next_cover lazyload" data-src="/postImages/HadoopCover.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>Hadoop学习笔记（一）前期准备</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/02/16/Hadoop学习笔记（三）MapReduce/" title="Hadoop学习笔记（三）MapReduce"><img class="relatedPosts_cover lazyload"data-src="/postImages/HadoopCover.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-16</div><div class="relatedPosts_title">Hadoop学习笔记（三）MapReduce</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/13/Hadoop学习笔记（二）HDFS/" title="Hadoop学习笔记（二）HDFS"><img class="relatedPosts_cover lazyload"data-src="/postImages/HadoopCover.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-13</div><div class="relatedPosts_title">Hadoop学习笔记（二）HDFS</div></div></a></div><div class="relatedPosts_item"><a href="/2020/06/10/Hadoop学习笔记（六）Yarn/" title="Hadoop学习笔记（六）Yarn"><img class="relatedPosts_cover lazyload"data-src="/postImages/HadoopCover.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-06-10</div><div class="relatedPosts_title">Hadoop学习笔记（六）Yarn</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/24/Hadoop学习笔记（四）数据的输入与输出/" title="Hadoop学习笔记（四）数据的输入与输出"><img class="relatedPosts_cover lazyload"data-src="/postImages/HadoopCover.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-24</div><div class="relatedPosts_title">Hadoop学习笔记（四）数据的输入与输出</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/13/Hadoop学习笔记（零）前期准备/" title="Hadoop学习笔记（一）前期准备"><img class="relatedPosts_cover lazyload"data-src="/postImages/HadoopCover.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-13</div><div class="relatedPosts_title">Hadoop学习笔记（一）前期准备</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = false == true ? true : false;
var verify = false == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'iYYoev4NDSyr3HqlY1VVCTIV-gzGzoHsz',
  appKey:'Hli8dWTFUKrXj9FnhnSQUvRe',
  placeholder:'快来评论吖！ヾﾉ≧∀≦)o',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10',
  lang:'en',
  recordIP: true
});</script></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By IT小王</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="icp"><a href="http://www.beian.miit.gov.cn" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"><span>闽ICP备18027071号-1</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="ribbon" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/canvas-nest.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>